USE [GD1C2015]
GO
CREATE PROCEDURE QUIEN_BAJO_EL_KERNEL.completar_transacciones
AS
BEGIN

  DECLARE @CANT_CUENTAS numeric(18, 0)
  DECLARE @CANT_CUENTAS_MODIF numeric(18, 0)
  DECLARE @CANT_TRANSF numeric(18, 0)
  DECLARE @i numeric(18, 0)
  DECLARE @cuenta numeric(18, 0)
  DECLARE @transf numeric(18, 0)


  SELECT
    @CANT_CUENTAS = COUNT(*)
  FROM QUIEN_BAJO_EL_KERNEL.CUENTA
  SELECT
    @CANT_CUENTAS_MODIF = COUNT(*)
  FROM QUIEN_BAJO_EL_KERNEL.CUENTA_MODIFICACION
  SELECT
    @CANT_TRANSF = COUNT(*)
  FROM QUIEN_BAJO_EL_KERNEL.TRANSFERENCIA

  -- LIMPIO

  UPDATE QUIEN_BAJO_EL_KERNEL.CUENTA
  SET id_transaccion = NULL
  UPDATE QUIEN_BAJO_EL_KERNEL.TRANSFERENCIA
  SET id_transaccion = NULL
  DELETE FROM QUIEN_BAJO_EL_KERNEL.TRANSACCIONES
  DBCC CHECKIDENT ('QUIEN_BAJO_EL_KERNEL.TRANSACCIONES', RESEED, 1)


  SET @i = 1

  WHILE @i <= @CANT_CUENTAS
  BEGIN

    INSERT INTO QUIEN_BAJO_EL_KERNEL.TRANSACCIONES (operacion_tipo)
      VALUES (2)
    SET @i = @i + 1

  END

  SET @i = 0
  UPDATE QUIEN_BAJO_EL_KERNEL.CUENTA
  SET @i = id_transaccion = @i + 1
  WHERE id_transaccion IS NULL


  SET @i = 1

  WHILE @i <= @CANT_TRANSF
  BEGIN

    INSERT INTO QUIEN_BAJO_EL_KERNEL.TRANSACCIONES (operacion_tipo)
      VALUES (1)

    SET @i = @i + 1

  END
  SET @i = @CANT_CUENTAS
  UPDATE QUIEN_BAJO_EL_KERNEL.TRANSFERENCIA
  SET @i = id_transaccion = @i + 1
  WHERE id_transaccion IS NULL


END
GO